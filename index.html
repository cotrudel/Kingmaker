<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <link rel="stylesheet" type="text/css" href="css/map.css">
    <link rel="stylesheet" type="text/css" href="css/building.css">
    <link rel="stylesheet" type="text/css" href="css/battle.css">
    <link rel="stylesheet" type="text/css" href="css/resources.css">
    <link rel="stylesheet" type="text/css" href="css/misc.css">
    <link rel="stylesheet" type="text/css" href="css/fog.css">
    <link rel="stylesheet" type="text/css" href="scripts/tooltipster/css/tooltipster.bundle.css" />

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.10.0.min.js"></script>
    <script type="text/javascript" src="scripts/tooltipster/js/tooltipster.bundle.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/interactjs@1.3/dist/interact.min.js"></script>

    <script type="text/javascript" src="js/plugin.js"></script>
    <script type="text/javascript" src="js/file.js"></script>
    <script type="text/javascript" src="js/map.js"></script>
    <script type="text/javascript" src="js/decoration.js"></script>
</head>

<body>
    <div class="editorBackground"></div>
    <div class="editMapDecoration">
        <div class="editField gimmeFullSpace">
            <input id="decorationToChange" style="display:none"/>
        </div>

        <!-- name="pont-epine" -->
        <div class="editField gimmeFullSpace" >
            <label for="nameMapDecoration" title="Name">Name</label>
            <input id="nameMapDecoration" />
        </div>

        <!-- alt="Pont" -->
        <div class="editField gimmeFullSpace">
            <label for="titleMapDecoration" title="Title">Title</label>
            <input id="titleMapDecoration" />
        </div>
        
        <div>
            <input type="button" value="Save changes" onclick="changeDecoration()" />
        </div>

    </div>
    <div class="wrapper" > 
        <div class="newMap">
            <div align="center" class="file gimmeSpace" onclick="openNew()" >
                <label >
                    <img src="images/new.png" title="Create a new map"/>
                </label>
            
                <input id="openNew" type="file" value="data/empty.map"/>
            </div>
            <hr>
        </div>

        <div class="openMap">
            <div align="center" class="file gimmeSpace" >
                <label for="openData">
                    <img src="images/load.png" title="Load existing map"/>
                </label>
            
                <input id="openData" onclick="loadFile()" type="file"/>
            </div>
        </div>

        <div class="saveMap">
            <div align="center" class="file gimmeSpace">
                <label for="saveData">
                    <img src="images/save.png" title="Save current map"/>
                </label>
            
                <input id="saveData" onclick="saveFile()" />
            </div>
            <hr>
        </div>

        <div class="displayer">
            <div class="checkboxDisplay">
                <input type="checkbox" id="building" class="checkbox" name="display-building" checked>
                <label for="building" class="label">Buildings</label>
            </div>
            <div class="checkboxDisplay">
                <input type="checkbox" id="resources" class="checkbox" name="display-resources">
                <label for="resources" class="label">Resources</label>
            </div>
            <div class="checkboxDisplay">
                <input type="checkbox" id="misc" class="checkbox" name="display-misc">
                <label for="misc" class="label">Misc</label>
            </div>
            <!-- <button onclick="createMapDecoration()">Add map decoration</button> -->
        </div>
    </div>

    <img src="images/map.jpg" class="background" />

    <div id="player">
        <img src="images/token.png" class="player draggable" />
    </div>
    
    <div class="mapDecoration">
    </div>
</body>
<script>
    $(document).ready(function () {
        // Checkbox
        createCheckbox("building");
        createCheckbox("resources");
        createCheckbox("misc");
        
        // interactjs
        drapAndDrop();
        tapTarget();

        // Edit map decoration
        $(".editorBackground").click(function(){
            clodeEditDecoration();
        })

        // Right click
        // document.getElementsByClassName('wrapper').addEventListener('contextmenu', function(ev) {
        //     ev.preventDefault();
        //     alert('success!');
        //     return false;
        // }, false);
    });

    function htmlToObject(element) {
        var img = imgPathToImgName(element.currentSrc);

        var name = element.name;
        var className = element.className.replace("fog", "")
                                        .replace("tooltipstered", "")
                                        .replace("tooltip", "")
                                        .replace("tap-target", "")
                                        .replace("inFront", "")
                                        .replace("draggable", "")
                                        .trim();
                                        // + " " + img; // remove the plugin class
        var top = element.style.top.replace("px", "").replace('"', "");
        var left = element.style.left.replace("px", "");
        var title = element.alt;

        return { "class": className.trim(), img, name, top, left, title };
    };

    function createImgTag(imgId, picName, elementName, cssClass, visited, elementType, top, left, title) {
        var fullClass = (cssClass + " " + visited + " " + elementType).trim();
        return "<img id='" + imgId + "' src='pics/" + picName + ".png' name='" + elementName + "' class='" + fullClass + "' style='top:" + top + "px; left:" + left + "px' title='" + title + "' alt='" + title + "' />";
    };

    function imgPathToImgName(imgPath){
        //Firefox doesn't suppport "?<=" regex properly so I use a workaround
        //var myRegexp = /(?<=pics\/)(.*)(?=\.png)/g;
        //var img = myRegexp.exec(element.currentSrc)[1];

        var imageName = imgPath.split("pics/");
        return imageName[1].replace(".png", "")
    };
</script>

</html>