<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <link rel="stylesheet" type="text/css" href="css/map.css">
    <link rel="stylesheet" type="text/css" href="css/menu.css">
    <link rel="stylesheet" type="text/css" href="css/building.css">
    <link rel="stylesheet" type="text/css" href="css/battle.css">
    <link rel="stylesheet" type="text/css" href="css/resources.css">
    <link rel="stylesheet" type="text/css" href="css/misc.css">
    <link rel="stylesheet" type="text/css" href="css/fog.css">
    <link rel="stylesheet" type="text/css" href="scripts/tooltipster/css/tooltipster.bundle.css" />

    <script type="text/javascript" src="scripts/jquery.1.12.4.js"></script>
    <script type="text/javascript" src="scripts/jquery.ddslick.min.js"></script>
    <script type="text/javascript" src="scripts/tooltipster/js/tooltipster.bundle.js"></script>
    <script type="text/javascript" src="scripts/interactjs/interact.js"></script>

    <script type="text/javascript" src="js/plugin.js"></script>
    <script type="text/javascript" src="js/file.js"></script>
    <script type="text/javascript" src="js/map.js"></script>
    <script type="text/javascript" src="js/decoration.js"></script>
</head>

<body>
    <div class="editorBackground"></div>
    <!-- Open / Create a map -->
    <div class="openOrCreateMap hide menu">
        <div class="newMap">
            <div align="center" class="file gimmeSpace" onclick="createNew()" >
                <label>
                    <img src="images/new.png" title="Create a new map"/>
                </label>
            
                <input id="createNew" type="file" value="data/empty.map"/>
            </div>
        </div>

        <div class="openMap">
            <div align="center" class="file gimmeSpace" >
                <label for="openData">
                    <img src="images/load.png" title="Load existing map"/>
                </label>
            
                <input id="openData" onclick="loadFile()" type="file"/>
            </div>
        </div>
    </div>

    <!-- Edit element -->
    <div class="editMapDecoration menu">
        <div class="field gimmeFullSpace">
            <input id="decorationToChange" style="display:none"/>
        </div>
        <div class="field gimmeFullSpace" >
            <label for="nameMapDecoration" title="Name">Name</label>
            <input id="nameMapDecoration" />
        </div>
        <div class="field gimmeFullSpace">
            <label for="titleMapDecoration" title="Title">Title</label>
            <input id="titleMapDecoration" />
        </div>
        <div class="gimmeFullSpace fr">
            <input type="button" value="Save changes" onclick="changeDecoration()" />
        </div>
    </div>

    <!-- Add element -->
    
    <div class="addElement menu hide">
        <!-- src="pics/village.png" -->
        <!-- Add a dropdown list with pics -->
        <!-- maybe do something automatic (could be done with the font)-->
        <select id="decorationDdl" class="decorationDdl">
            <option value="0" data-imagesrc="pics/argile.png" data-description="Argile">Argile</option>
            <option value="1" data-imagesrc="pics/bac.png" data-description="Ferry">Ferry</option>
            <option value="2" data-imagesrc="pics/ble.png" data-description="Blé">Blé</option>
            <option value="3" data-imagesrc="pics/cabane.png" data-description="Cabane">Cabane</option>
            <option value="4" data-imagesrc="pics/camp.png" data-description="Camp">Camp</option>
            <option value="5" data-imagesrc="pics/colline.png" data-description="Hill">Hill</option>
            <option value="6" data-imagesrc="pics/cottage.png" data-description="Cottage">Cottage</option>
            <option value="7" data-imagesrc="pics/dolmen.png" data-description="Dolmen">Dolmen</option>
            <option value="8" data-imagesrc="pics/dragon.png" data-description="Dragon">Dragon</option>
            <option value="9" data-imagesrc="pics/elk.png" data-description="Elk">Elk</option>
            <option value="10" data-imagesrc="pics/grotte.png" data-description="Cave">Cave</option>
            <option value="11" data-imagesrc="pics/house.png" data-description="House">House</option>
            <option value="12" data-imagesrc="pics/mine.png" data-description="Mine">Mine</option>
            <option value="13" data-imagesrc="pics/path.png" data-description="Path">Path</option>
            <option value="14" data-imagesrc="pics/pont.png" data-description="Bridge">Bridge</option>
            <option value="15" data-imagesrc="pics/raspberry.png" data-description="Raspberry">Raspberry</option>
            <option value="16" data-imagesrc="pics/rock.png" data-description="Rock">Rock</option>
            <option value="17" data-imagesrc="pics/ruche.png" data-description="Ruche">Ruche</option>
            <option value="18" data-imagesrc="pics/ruine.png" data-description="Ruin">Ruin</option>
            <option value="19" data-imagesrc="pics/ruinecyclop.png" data-description="Ruin cyclop">Ruin</option>
            <option value="20" data-imagesrc="pics/sign.png" data-description="Sign">Sign</option>
            <option value="21" data-imagesrc="pics/source.png" data-description="Source">Source</option>
            <option value="22" data-imagesrc="pics/spider.png" data-description="Spider-web">Spider-web</option>
            <option value="23" data-imagesrc="pics/stag.png" data-description="Stag">Stag</option>
            <option value="24" data-imagesrc="pics/swamp.png" data-description="Swamp">Swamp</option>
            <option value="25" data-imagesrc="pics/tombe.png" data-description="Tumb">Tumb</option>
            <option value="26" data-imagesrc="pics/tree.png" data-description="Tree">Tree</option>
            <option value="27" data-imagesrc="pics/village.png" data-description="village">village</option>
        </select>
    
        <!-- name="leningrad" -->
        <!-- Add a hint for no space -->
        <div class="field gimmeFullSpace" >
            <label for="addNameMapDecoration" title="Name">Name</label>
            <input id="addNameMapDecoration" />
        </div>
        
        <!-- class="building -->
        <!-- Add a dropdown list with Building, Resources and Misc -->

        <!-- village -->
        <!-- Depend of the pics ? -->

        <div class="field gimmeFullSpace">
            <input id="addClassMapDecoration" class="hide" value="tooltip tap-target draggable inFront" />
        </div>

        <!--  style="top: 300px; left: 3600px;" -->
        <!-- Create on player token -->  

        <!--  alt title -->
        <div class="field gimmeFullSpace">
            <label for="addTitleMapDecoration" title="Title">Title</label>
            <input id="addTitleMapDecoration" />
        </div>
        
        <div class="gimmeFullSpace fr">
            <input type="button" value="Create element" onclick="createDecoration()" />
        </div>
    </div>


    <div class="wrapper" > 
        <div class="saveMap">
            <div align="center" class="file gimmeSpace">
                <label for="saveData">
                    <img src="images/save.png" title="Save current map"/>
                </label>
            
                <input id="saveData" onclick="saveFile()" />
            </div>
        </div>

        <hr>

        <button onclick="addMapDecoration()">Add element</button>

        <hr>

        <div class="displayer">
            <div class="checkboxDisplay">
                <input type="checkbox" id="building" class="checkbox" name="display-building" checked>
                <label for="building" class="label">Buildings</label>
            </div>
            <div class="checkboxDisplay">
                <input type="checkbox" id="resources" class="checkbox" name="display-resources">
                <label for="resources" class="label">Resources</label>
            </div>
            <div class="checkboxDisplay">
                <input type="checkbox" id="misc" class="checkbox" name="display-misc">
                <label for="misc" class="label">Misc</label>
            </div>
        </div>
    </div>

    <img src="images/map.jpg" class="background" />

    <div id="player">
        <img src="images/token.png" class="player draggable" />
    </div>
    
    <div class="mapDecoration">
    </div>
</body>
<script>
    $(document).ready(function () {
        idElement = 1;

        // Checkbox
        createCheckbox("building");
        createCheckbox("resources");
        createCheckbox("misc");
        
        // interactjs
        dragAndDrop();
        tapTarget();

        // Display OpenCreate map
        $(".openOrCreateMap").removeClass("hide");
        $(".openOrCreateMap").addClass("inline-flex");
        $(".editorBackground").show();
        $(".wrapper").hide();

        // Dropdown list create element
        $('#decorationDdl').ddslick({
            height: 300
        });
    });

    function htmlToObject(element) {
        var img = imgPathToImgName(element.currentSrc);

        var name = element.name;
        var className = element.className.replace("fog", "")
                                        .replace("tooltipstered", "")
                                        .replace("tooltip", "")
                                        .replace("tap-target", "")
                                        .replace("inFront", "")
                                        .replace("draggable", "")
                                        .trim();
                                        // + " " + img; // remove the plugin class
        var top = element.style.top.replace("px", "").replace('"', "");
        var left = element.style.left.replace("px", "");
        var title = element.alt;

        return { "class": className.trim(), img, name, top, left, title };
    };

    function createImgTag(imgId, picName, elementName, cssClass, visited, elementType, top, left, title) {
        var fullClass = (cssClass + " " + visited + " " + elementType).trim();
        return "<img id='" + imgId + "' src='pics/" + picName + ".png' name='" + elementName + "' class='" + fullClass + "' style='top:" + top + "px; left:" + left + "px' title='" + title + "' alt='" + title + "' />";
    };

    function imgPathToImgName(imgPath){
        //Firefox doesn't suppport "?<=" regex properly so I use a workaround
        //var myRegexp = /(?<=pics\/)(.*)(?=\.png)/g;
        //var img = myRegexp.exec(element.currentSrc)[1];

        var imageName = imgPath.split("pics/");
        return imageName[1].replace(".png", "")
    };
</script>

</html>